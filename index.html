<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Findery â€” Discover Thai Small Businesses</title>
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=Sarabun:wght@300;400;500&display=swap" rel="stylesheet" />
<style>
:root {
  --cream: #FAF7F2;
  --warm-white: #FFFDF9;
  --clay: #C9643A;
  --clay-light: #E8845E;
  --clay-dark: #A04E2B;
  --charcoal: #1C1C1C;
  --mid: #6B6560;
  --soft: #B8B0A8;
  --border: #E8E2DA;
  --tag-bg: #F0EBE3;
}
* { box-sizing: border-box; margin: 0; padding: 0; }
body { font-family: 'Sarabun', sans-serif; background: var(--cream); color: var(--charcoal); min-height: 100vh; }

nav {
  background: var(--warm-white);
  border-bottom: 1px solid var(--border);
  padding: 0 20px;
  height: 56px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  position: sticky;
  top: 0;
  z-index: 100;
}
.logo { font-family: 'Syne', sans-serif; font-weight: 800; font-size: 22px; color: var(--clay); letter-spacing: -0.5px; }
.logo span { color: var(--charcoal); }
.btn-nav {
  background: var(--clay); color: white; border: none;
  padding: 8px 18px; border-radius: 100px;
  font-family: 'Sarabun', sans-serif; font-size: 14px; font-weight: 500;
  cursor: pointer; transition: background 0.15s;
}
.btn-nav:hover { background: var(--clay-dark); }

.hero { padding: 52px 20px 32px; text-align: center; max-width: 560px; margin: 0 auto; }
.hero-badge {
  display: inline-block; background: var(--tag-bg); color: var(--mid);
  font-size: 12px; font-weight: 500; padding: 4px 12px; border-radius: 100px;
  margin-bottom: 18px; letter-spacing: 0.5px; text-transform: uppercase;
}
.hero h1 { font-family: 'Syne', sans-serif; font-size: clamp(28px,7vw,44px); font-weight: 800; line-height: 1.1; margin-bottom: 14px; letter-spacing: -1px; }
.hero h1 em { font-style: normal; color: var(--clay); }
.hero p { color: var(--mid); font-size: 16px; line-height: 1.6; }

.search-wrap { position: relative; max-width: 420px; margin: 28px auto; padding: 0 20px; }
.search-wrap input {
  width: 100%; padding: 14px 20px 14px 44px;
  border: 1.5px solid var(--border); border-radius: 100px;
  background: white; font-family: 'Sarabun', sans-serif; font-size: 15px;
  color: var(--charcoal); outline: none; transition: border-color 0.15s;
}
.search-wrap input:focus { border-color: var(--clay); }
.search-wrap input::placeholder { color: var(--soft); }
.search-icon { position: absolute; left: 36px; top: 50%; transform: translateY(-50%); color: var(--soft); pointer-events: none; }

.categories { display: flex; gap: 8px; justify-content: center; flex-wrap: wrap; margin-bottom: 36px; padding: 0 20px; }
.cat-btn {
  padding: 8px 16px; border-radius: 100px; border: 1.5px solid var(--border);
  background: white; font-family: 'Sarabun', sans-serif; font-size: 14px;
  color: var(--mid); cursor: pointer; transition: all 0.15s;
}
.cat-btn:hover, .cat-btn.active { border-color: var(--clay); color: var(--clay); background: #FDF1EC; }

.section-header { max-width: 700px; margin: 0 auto 16px; padding: 0 20px; display: flex; align-items: baseline; justify-content: space-between; }
.section-title { font-family: 'Syne', sans-serif; font-size: 18px; font-weight: 700; }
.count { font-size: 13px; color: var(--soft); }

.grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 16px; max-width: 700px; margin: 0 auto; padding: 0 20px 60px; }

.card { background: white; border: 1.5px solid var(--border); border-radius: 16px; padding: 20px; cursor: pointer; transition: transform 0.15s, box-shadow 0.15s, border-color 0.15s; }
.card:hover { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(0,0,0,0.07); border-color: var(--clay-light); }
.card-top { display: flex; align-items: flex-start; gap: 14px; margin-bottom: 14px; }
.shop-avatar { width: 52px; height: 52px; border-radius: 14px; background: var(--tag-bg); display: flex; align-items: center; justify-content: center; font-size: 24px; flex-shrink: 0; }
.shop-info { flex: 1; min-width: 0; }
.shop-name { font-family: 'Syne', sans-serif; font-size: 16px; font-weight: 700; margin-bottom: 4px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.shop-handle { font-size: 13px; color: var(--clay); font-weight: 500; }
.shop-desc { font-size: 14px; color: var(--mid); line-height: 1.55; margin-bottom: 14px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
.card-footer { display: flex; align-items: center; justify-content: space-between; }
.tag { background: var(--tag-bg); color: var(--mid); font-size: 12px; padding: 4px 10px; border-radius: 100px; font-weight: 500; }
.view-btn { font-size: 13px; font-weight: 500; color: var(--mid); }

.empty { text-align: center; padding: 60px 20px; color: var(--soft); font-size: 15px; grid-column: 1/-1; }
.empty-icon { font-size: 40px; margin-bottom: 12px; }

.submit-section { background: var(--charcoal); padding: 52px 20px; }
.submit-inner { max-width: 480px; margin: 0 auto; }
.submit-section h2 { font-family: 'Syne', sans-serif; font-size: 28px; font-weight: 800; color: white; margin-bottom: 12px; letter-spacing: -0.5px; text-align: center; }
.submit-section > .submit-inner > p { color: #A09890; font-size: 15px; line-height: 1.6; margin-bottom: 32px; text-align: center; }
.form-group { margin-bottom: 14px; }
.form-group label { display: block; font-size: 13px; font-weight: 500; color: #A09890; margin-bottom: 6px; }
.form-group input,
.form-group select,
.form-group textarea {
  width: 100%; padding: 12px 16px;
  background: #2A2A2A; border: 1.5px solid #383838; border-radius: 10px;
  font-family: 'Sarabun', sans-serif; font-size: 15px; color: white;
  outline: none; transition: border-color 0.15s;
  -webkit-appearance: none; appearance: none;
}
.form-group input:focus, .form-group select:focus, .form-group textarea:focus { border-color: var(--clay); }
.form-group input::placeholder, .form-group textarea::placeholder { color: #555; }
.form-group select option { background: #2A2A2A; color: white; }
.form-group textarea { resize: vertical; min-height: 90px; }

.btn-primary {
  width: 100%; padding: 14px; background: var(--clay); color: white; border: none;
  border-radius: 100px; font-family: 'Syne', sans-serif; font-size: 16px; font-weight: 700;
  cursor: pointer; margin-top: 8px; transition: background 0.15s; display: block;
}
.btn-primary:hover { background: var(--clay-dark); }

.success-msg {
  display: none; background: #1E2E1E; border: 1.5px solid #3A5A3A; color: #7EC87E;
  padding: 14px 20px; border-radius: 10px; font-size: 14px; margin-top: 14px;
}

footer { background: var(--charcoal); border-top: 1px solid #2A2A2A; padding: 20px; text-align: center; font-size: 13px; color: #555; }
footer span { color: var(--clay); }

.modal-overlay {
  position: fixed; inset: 0; background: rgba(0,0,0,0.45); z-index: 200;
  opacity: 0; pointer-events: none; transition: opacity 0.25s ease; backdrop-filter: blur(2px);
}
.modal-overlay.open { opacity: 1; pointer-events: all; }

.profile-sheet {
  position: fixed; left: 50%; bottom: 0;
  transform: translateX(-50%) translateY(100%);
  width: 100%; max-width: 520px; max-height: 92vh;
  background: var(--warm-white); border-radius: 24px 24px 0 0;
  z-index: 201; overflow: hidden; display: flex; flex-direction: column;
  transition: transform 0.35s cubic-bezier(0.32,0.72,0,1);
}
.profile-sheet.open { transform: translateX(-50%) translateY(0); }
.sheet-handle { width: 36px; height: 4px; background: var(--border); border-radius: 2px; margin: 12px auto 0; flex-shrink: 0; }
.sheet-scroll { overflow-y: auto; flex: 1; }
.close-btn { width: 30px; height: 30px; border-radius: 50%; background: var(--tag-bg); border: none; color: var(--mid); font-size: 16px; cursor: pointer; display: flex; align-items: center; justify-content: center; }
.profile-header { padding: 0 20px 0; margin-top: 0; }
.profile-avatar { width: 72px; height: 72px; border-radius: 18px; background: var(--tag-bg); border: 4px solid var(--warm-white); display: flex; align-items: center; justify-content: center; font-size: 32px; margin-bottom: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
.profile-name { font-family: 'Syne', sans-serif; font-size: 20px; font-weight: 800; margin-bottom: 3px; }
.profile-handle { font-size: 14px; color: var(--clay); font-weight: 500; margin-bottom: 10px; }
.profile-tag { display: inline-block; background: var(--tag-bg); color: var(--mid); font-size: 12px; padding: 3px 10px; border-radius: 100px; font-weight: 500; margin-bottom: 14px; }
.profile-stats { display: flex; border-top: 1px solid var(--border); border-bottom: 1px solid var(--border); margin: 0 20px; }
.stat { flex: 1; text-align: center; padding: 14px 0; }
.stat + .stat { border-left: 1px solid var(--border); }
.stat-value { font-family: 'Syne', sans-serif; font-size: 17px; font-weight: 700; display: block; }
.stat-label { font-size: 11px; color: var(--soft); text-transform: uppercase; letter-spacing: 0.4px; }
.profile-section { padding: 18px 20px 0; }
.profile-section-title { font-family: 'Syne', sans-serif; font-size: 13px; font-weight: 700; color: var(--soft); text-transform: uppercase; letter-spacing: 0.6px; margin-bottom: 8px; }
.profile-desc { font-size: 15px; color: var(--mid); line-height: 1.6; }
.profile-tags { display: flex; flex-wrap: wrap; gap: 7px; padding: 14px 20px 0; }
.ptag { background: var(--tag-bg); color: var(--mid); font-size: 13px; padding: 5px 12px; border-radius: 100px; }
.photo-grid { display: grid; grid-template-columns: repeat(3,1fr); gap: 2px; margin-top: 18px; }
.photo-cell { aspect-ratio: 1; background: var(--tag-bg); display: flex; align-items: center; justify-content: center; font-size: 28px; }
.profile-ctas { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 20px; flex-shrink: 0; }
.cta-ig { display: flex; align-items: center; justify-content: center; gap: 7px; padding: 13px; background: var(--charcoal); color: white; border: none; border-radius: 12px; font-family: 'Syne', sans-serif; font-size: 14px; font-weight: 700; cursor: pointer; text-decoration: none; }
.cta-line { display: flex; align-items: center; justify-content: center; gap: 7px; padding: 13px; background: #06C755; color: white; border: none; border-radius: 12px; font-family: 'Syne', sans-serif; font-size: 14px; font-weight: 700; cursor: pointer; text-decoration: none; }
.cta-line.no-line { background: var(--tag-bg); color: var(--mid); pointer-events: none; }

@keyframes fadeUp { from { opacity: 0; transform: translateY(16px); } to { opacity: 1; transform: translateY(0); } }
@media (max-width: 480px) { .grid { grid-template-columns: 1fr; } }
</style>
</head>
<body>

<nav>
  <div class="logo">find<span>ery</span></div>
  <button class="btn-nav" onclick="document.getElementById('submitSection').scrollIntoView({behavior:'smooth'})">List your shop</button>
</nav>

<div class="hero">
  <div class="hero-badge">ğŸ‡¹ğŸ‡­ Made for Thai small businesses</div>
  <h1>Discover <em>hidden</em> Thai shops you'll love</h1>
  <p>Small businesses that only live on Instagram â€” now in one place. Find clothes, food, handmade crafts, and more.</p>
</div>

<div class="search-wrap">
  <svg class="search-icon" width="17" height="17" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
    <circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/>
  </svg>
  <input type="text" id="searchInput" placeholder="Search shops, categories..." oninput="renderShops()" />
</div>

<div class="categories">
  <button class="cat-btn active" onclick="setCategory('all',this)">âœ¦ All</button>
  <button class="cat-btn" onclick="setCategory('Fashion & Clothing',this)">ğŸ‘— Fashion</button>
  <button class="cat-btn" onclick="setCategory('Food & Homemade',this)">ğŸ± Food</button>
  <button class="cat-btn" onclick="setCategory('Beauty & Wellness',this)">âœ¨ Beauty</button>
  <button class="cat-btn" onclick="setCategory('Handmade & Craft',this)">ğŸ§µ Handmade</button>
</div>

<div class="section-header">
  <div class="section-title">Shops</div>
  <div class="count" id="shopCount"></div>
</div>
<div class="grid" id="shopGrid"></div>

<div class="submit-section" id="submitSection">
  <div class="submit-inner">
    <h2>Own a small business?</h2>
    <p>List your Instagram shop on Findery â€” it's free and takes 2 minutes.</p>
    <div class="form-group">
      <label>Shop name *</label>
      <input type="text" id="f_name" placeholder="e.g. Moodthong Vintage" />
    </div>
    <div class="form-group">
      <label>Instagram link *</label>
      <input type="text" id="f_ig" placeholder="https://instagram.com/yourshop" />
    </div>
    <div class="form-group">
      <label>Category *</label>
      <select id="f_cat">
        <option value="">Select a category</option>
        <option value="Fashion & Clothing">Fashion &amp; Clothing</option>
        <option value="Food & Homemade">Food &amp; Homemade</option>
        <option value="Beauty & Wellness">Beauty &amp; Wellness</option>
        <option value="Handmade & Craft">Handmade &amp; Craft</option>
        <option value="Photography & Creative">Photography &amp; Creative</option>
      </select>
    </div>
    <div class="form-group">
      <label>Short description *</label>
      <textarea id="f_desc" placeholder="What do you sell? Who is it for?"></textarea>
    </div>
    <div class="form-group">
      <label>LINE ID (optional)</label>
      <input type="text" id="f_line" placeholder="@yourline" />
    </div>
    <button class="btn-primary" onclick="doSubmit()">Submit my shop â†’</button>
    <div id="errorMsg" style="display:none;background:#2E1E1E;border:1.5px solid #5A3A3A;color:#E87E7E;padding:14px 20px;border-radius:10px;font-size:14px;margin-top:14px;">âš ï¸ Please fill in all required fields.</div>
    <div class="success-msg" id="successMsg">ğŸ‰ Your shop has been added! Scroll up to see it.</div>
  </div>
</div>

<footer>Â© 2025 <span>Findery</span> â€” Discover Thailand's hidden small businesses</footer>

<div class="modal-overlay" id="overlay" onclick="closeProfile()"></div>
<div class="profile-sheet" id="sheet">
  <div class="sheet-handle"></div>
  <div class="sheet-scroll">
    <div style="position:relative;padding:14px 14px 0;text-align:right;flex-shrink:0;">
      <button class="close-btn" onclick="closeProfile()" style="position:static;background:var(--tag-bg);color:var(--mid);">âœ•</button>
    </div>
    <div class="profile-header">
      <div class="profile-avatar" id="pAvatar"></div>
      <div class="profile-name" id="pName"></div>
      <div class="profile-handle" id="pHandle"></div>
      <div class="profile-tag" id="pTag"></div>
    </div>
    <div class="profile-stats">
      <div class="stat"><span class="stat-value" id="pPosts">â€”</span><span class="stat-label">Posts</span></div>
      <div class="stat"><span class="stat-value" id="pFollowers">â€”</span><span class="stat-label">Followers</span></div>
      <div class="stat"><span class="stat-value" id="pSince">â€”</span><span class="stat-label">On Findery</span></div>
    </div>
    <div class="profile-section">
      <div class="profile-section-title">About</div>
      <div class="profile-desc" id="pDesc"></div>
    </div>
    <div class="profile-tags" id="pTags"></div>
    <div class="profile-section" style="padding-top:18px;">
      <div class="profile-section-title">Posts</div>
    </div>
    <div class="photo-grid" id="pPhotos"></div>
  </div>
  <div class="profile-ctas">
    <a id="pIG" href="#" target="_blank" class="cta-ig">
      <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><rect x="2" y="2" width="20" height="20" rx="5"/><circle cx="12" cy="12" r="5"/><circle cx="17.5" cy="6.5" r="1.5" fill="currentColor" stroke="none"/></svg>
      Instagram
    </a>
    <a id="pLine" href="#" class="cta-line no-line">LINE</a>
  </div>
</div>

<script>
var SHOPS = [
  {
    name: "Moodthong Vintage", handle: "@moodthong.vintage", category: "Fashion & Clothing",
    desc: "Y2K and 90s vintage finds sourced from Japan and Korea. Sizes XSâ€“L, new drops every Friday.",
    fullDesc: "Y2K and 90s vintage finds hand-picked from Japan and Korea flea markets. Every piece is one-of-a-kind. New drops every Friday at 8PM. Based in Bangkok, ships nationwide via Kerry Express.",
    emoji: "ğŸ‘—", ig: "https://instagram.com/moodthong.vintage", line: "@moodthong",
    tags: ["Vintage","Y2K","Korean fashion","Ships nationwide"],
    posts: "248", followers: "12.4K", since: "2024",
    cover: "linear-gradient(135deg,#FADADD,#C9643A)",
    photos: ["ğŸ‘—","ğŸ§¥","ğŸ‘š","ğŸ‘–","ğŸ›ï¸","âœ¨","ğŸ‘’","ğŸ•¶ï¸","ğŸ’"]
  },
  {
    name: "Baan Kanom", handle: "@baankanom.bkk", category: "Food & Homemade",
    desc: "Homemade Thai desserts made to order â€” kanom krok, taro cake, pandan rolls. DM for orders.",
    fullDesc: "Authentic Thai desserts made from scratch every morning using family recipes passed down three generations. Order via DM at least 2 days in advance. Pickup in On Nut or delivery within Bangkok.",
    emoji: "ğŸ¡", ig: "https://instagram.com/baankanom.bkk", line: "@baankanom",
    tags: ["Thai desserts","Made to order","Bangkok delivery","Pickup On Nut"],
    posts: "132", followers: "8.1K", since: "2023",
    cover: "linear-gradient(135deg,#FDEBD0,#E59866)",
    photos: ["ğŸ¡","ğŸ°","ğŸŸ¢","ğŸŸ¡","ğŸ®","ğŸ§†","ğŸ¯","ğŸ«“","ğŸ‚"]
  },
  {
    name: "Soft Studio", handle: "@softstudio.th", category: "Fashion & Clothing",
    desc: "Handmade linen and cotton sets for women. Slow fashion, limited pieces per design.",
    fullDesc: "Slow fashion label making handmade linen and cotton co-ord sets for women. Each design is made in batches of 5â€“10 pieces only. Natural fabrics, muted tones, everyday comfort.",
    emoji: "ğŸ§º", ig: "https://instagram.com/softstudio.th", line: null,
    tags: ["Slow fashion","Linen","Handmade","Co-ords"],
    posts: "89", followers: "5.6K", since: "2024",
    cover: "linear-gradient(135deg,#F5F0E8,#C9A87C)",
    photos: ["ğŸ§º","ğŸ¤","ğŸª¡","ğŸ‘š","ğŸ§µ","ğŸŒ¾","ğŸª","ğŸ‘—","ğŸ›’"]
  },
  {
    name: "Glowlab Bangkok", handle: "@glowlab.bkk", category: "Beauty & Wellness",
    desc: "Natural skincare made in small batches. Serums, toners, and face oils for Southeast Asian skin.",
    fullDesc: "Small-batch skincare formulated for Southeast Asian skin. No parabens, no sulfates. DM for skin consultations before purchase.",
    emoji: "ğŸŒ¿", ig: "https://instagram.com/glowlab.bkk", line: "@glowlab.bkk",
    tags: ["Natural skincare","Thai-made","Cruelty free","For oily skin"],
    posts: "176", followers: "22.3K", since: "2023",
    cover: "linear-gradient(135deg,#D5F5E3,#27AE60)",
    photos: ["ğŸŒ¿","ğŸ’š","ğŸ§´","ğŸŒ±","âœ¨","ğŸ’§","ğŸª´","ğŸƒ","ğŸ«§"]
  },
  {
    name: "Knot & Thread", handle: "@knotandthread.th", category: "Handmade & Craft",
    desc: "Hand-woven bags and home accessories inspired by northern Thai textile traditions.",
    fullDesc: "Handcraft studio based in Chiang Mai. All pieces hand-woven using traditional northern Thai techniques. Each item takes 3â€“7 days. Custom orders welcome.",
    emoji: "ğŸ§µ", ig: "https://instagram.com/knotandthread.th", line: "@knotthread",
    tags: ["Chiang Mai","Hand-woven","Northern Thai craft","Custom orders"],
    posts: "204", followers: "9.8K", since: "2024",
    cover: "linear-gradient(135deg,#FDEBD0,#9B59B6)",
    photos: ["ğŸ§µ","ğŸª¡","ğŸ‘œ","ğŸ¨","ğŸ§¶","ğŸº","ğŸ€","ğŸ›ï¸","âœ‚ï¸"]
  },
  {
    name: "Mama Ferments", handle: "@mamaferments", category: "Food & Homemade",
    desc: "Homemade kimchi, miso, and fermented hot sauce. Delivers in Bangkok, ships nationwide.",
    fullDesc: "Home fermentation studio. Kimchi, gochujang, miso, and seasonal ferments. No preservatives. Ships nationwide in insulated packaging.",
    emoji: "ğŸ«™", ig: "https://instagram.com/mamaferments", line: "@mamaferments",
    tags: ["Fermented foods","Kimchi","Ships nationwide","No preservatives"],
    posts: "97", followers: "6.2K", since: "2025",
    cover: "linear-gradient(135deg,#FADBD8,#E74C3C)",
    photos: ["ğŸ«™","ğŸŒ¶ï¸","ğŸ¥¬","ğŸœ","ğŸ§„","ğŸ«š","ğŸ¥•","ğŸ±","ğŸ«§"]
  }
];

var AIRTABLE_TOKEN = 'pate4m0HIrUgvnIZK.589697d1362a3bd8b14cb712f9c40a7a1d0bd539b91684b4ded458648c62ede7';
var AIRTABLE_BASE_ID = 'app3h7e16KyGoVoBx/tblGj6UVmR3M0f9nf/viwsGV5Dzi08k8suE?blocks=hide';
var AIRTABLE_TABLE = 'Shops';

function saveToAirtable(shop) {
  fetch('https://api.airtable.com/v0/' + AIRTABLE_BASE_ID + '/' + AIRTABLE_TABLE, {
    method: 'POST',
    headers: {
      'Authorization': 'Bearer ' + AIRTABLE_TOKEN,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      fields: {
        'Name': shop.name,
        'Handle': shop.handle,
        'Instagram': shop.ig,
        'Category': shop.category,
        'Description': shop.desc,
        'LINE': shop.line || '',
        'Status': 'Pending'
      }
    })
  })
  .then(function(res) { return res.json(); })
  .then(function(data) { console.log('Saved to Airtable:', data); })
  .catch(function(err) { console.error('Airtable error:', err); });
}



function setCategory(cat, el) {
  activeCat = cat;
  var btns = document.querySelectorAll('.cat-btn');
  for (var i = 0; i < btns.length; i++) btns[i].classList.remove('active');
  el.classList.add('active');
  renderShops();
}

function renderShops() {
  var term = document.getElementById('searchInput').value.toLowerCase();
  var out = [];
  for (var i = 0; i < SHOPS.length; i++) {
    var s = SHOPS[i];
    if (activeCat !== 'all' && s.category !== activeCat) continue;
    if (term && s.name.toLowerCase().indexOf(term) < 0 && s.handle.toLowerCase().indexOf(term) < 0 && s.desc.toLowerCase().indexOf(term) < 0 && s.category.toLowerCase().indexOf(term) < 0) continue;
    out.push({shop: s, idx: i});
  }
  document.getElementById('shopCount').textContent = out.length + ' shops';
  if (out.length === 0) {
    document.getElementById('shopGrid').innerHTML = '<div class="empty"><div class="empty-icon">ğŸ”</div>No shops found.</div>';
    return;
  }
  var html = '';
  for (var j = 0; j < out.length; j++) {
    var s = out[j].shop;
    var idx = out[j].idx;
    html += '<div class="card" onclick="openProfile(' + idx + ')">' +
      '<div class="card-top">' +
        '<div class="shop-avatar">' + s.emoji + '</div>' +
        '<div class="shop-info">' +
          '<div class="shop-name">' + s.name + '</div>' +
          '<div class="shop-handle">' + s.handle + '</div>' +
        '</div>' +
      '</div>' +
      '<div class="shop-desc">' + s.desc + '</div>' +
      '<div class="card-footer">' +
        '<span class="tag">' + s.category + '</span>' +
        '<span class="view-btn">View profile â†’</span>' +
      '</div>' +
    '</div>';
  }
  document.getElementById('shopGrid').innerHTML = html;
}

function openProfile(idx) {
  var s = SHOPS[idx];
  document.getElementById('pAvatar').textContent = s.emoji;
  document.getElementById('pName').textContent = s.name;
  document.getElementById('pHandle').textContent = s.handle;
  document.getElementById('pTag').textContent = s.category;
  document.getElementById('pPosts').textContent = s.posts || 'â€”';
  document.getElementById('pFollowers').textContent = s.followers || 'â€”';
  document.getElementById('pSince').textContent = s.since || 'â€”';
  document.getElementById('pDesc').textContent = s.fullDesc || s.desc;
  var th = '';
  if (s.tags) for (var i = 0; i < s.tags.length; i++) th += '<span class="ptag">' + s.tags[i] + '</span>';
  document.getElementById('pTags').innerHTML = th;
  var ph = '';
  if (s.photos) for (var j = 0; j < s.photos.length; j++) ph += '<div class="photo-cell">' + s.photos[j] + '</div>';
  document.getElementById('pPhotos').innerHTML = ph;
  document.getElementById('pIG').href = s.ig || '#';
  var lineEl = document.getElementById('pLine');
  if (s.line) {
    lineEl.href = 'https://line.me/ti/p/' + s.line.replace('@','');
    lineEl.className = 'cta-line';
    lineEl.textContent = 'LINE';
  } else {
    lineEl.href = '#';
    lineEl.className = 'cta-line no-line';
    lineEl.textContent = 'No LINE';
  }
  document.getElementById('overlay').classList.add('open');
  document.getElementById('sheet').classList.add('open');
  document.body.style.overflow = 'hidden';
}

function closeProfile() {
  document.getElementById('overlay').classList.remove('open');
  document.getElementById('sheet').classList.remove('open');
  document.body.style.overflow = '';
}

function doSubmit() {
  var name = document.getElementById('f_name').value.trim();
  var igRaw = document.getElementById('f_ig').value.trim();
  var cat = document.getElementById('f_cat').value;
  var desc = document.getElementById('f_desc').value.trim();
  var line = document.getElementById('f_line').value.trim();

  var errEl = document.getElementById('errorMsg');
  if (!name || !igRaw || !cat || !desc) {
    errEl.style.display = 'block';
    setTimeout(function() { errEl.style.display = 'none'; }, 4000);
    return;
  }
  errEl.style.display = 'none';

  var igUrl = (igRaw.indexOf('http') === 0) ? igRaw : 'https://instagram.com/' + igRaw.replace('@','');
  var m = igUrl.match(/instagram\.com\/([^/?#]+)/);
  var handle = m ? '@' + m[1] : igRaw;

  var shop = {
    name: name, handle: handle, category: cat,
    desc: desc, fullDesc: desc, emoji: 'ğŸª',
    ig: igUrl, line: line || null, tags: [cat],
    posts: 'â€”', followers: 'â€”', since: '2025',
    cover: 'linear-gradient(135deg,#F2C4A8,#C9643A)',
    photos: ['ğŸª','ğŸ“¦','âœ¨','ğŸ›ï¸','ğŸ’«','â­','ğŸ','ğŸ“¸','ğŸ’¬']
  };

  saveToAirtable(shop);
  SHOPS.unshift(shop);

  document.getElementById('f_name').value = '';
  document.getElementById('f_ig').value = '';
  document.getElementById('f_cat').value = '';
  document.getElementById('f_desc').value = '';
  document.getElementById('f_line').value = '';

  var msg = document.getElementById('successMsg');
  msg.style.display = 'block';
  setTimeout(function() { msg.style.display = 'none'; }, 5000);

  renderShops();
  window.scrollTo({top: 0, behavior: 'smooth'});
}

document.addEventListener('keydown', function(e) { if (e.key === 'Escape') closeProfile(); });
renderShops();
</script>
</body>
</html>
